<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¾®å…‰è¨ˆç•«ï¼šå¾©æ­¸æ—…ç¨‹ (Project Glimmer)</title>
    <style>
        :root {
            --bg-color: #1a1a1d;
            --panel-color: #2b2b2e;
            --text-color: #e0e0e0;
            --accent-color: #4ecca3;
            --danger-color: #e23e57;
            --warning-color: #fce38a;
            --muted-color: #95a5a6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
        }

        .game-container {
            display: grid;
            grid-template-columns: 250px 1fr 280px;
            gap: 20px;
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            background-color: #000;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        /* --- å·¦å´ï¼šæ•¸å€¼é¢æ¿ --- */
        .stats-panel {
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .avatar {
            width: 80px;
            height: 80px;
            background-color: #444;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 2px solid var(--muted-color);
            flex-shrink: 0;
        }

        .header-info {
            text-align: center;
            margin-bottom: 10px;
            color: var(--accent-color);
            font-size: 1.1rem;
            font-weight: bold;
        }

        .stat-group { margin-bottom: 5px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 3px; }
        .progress-bar { width: 100%; height: 8px; background-color: #444; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.3s ease, background-color 0.3s ease; }

        /* --- ä¸­é–“ï¼šä¸»éŠæˆ²å€ --- */
        .main-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
            overflow: hidden;
        }

        .log-area {
            flex: 1;
            min-height: 0;
            background-color: var(--panel-color);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            border-left: 4px solid var(--accent-color);
            font-size: 1rem;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .log-entry { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #444; animation: fadeIn 0.4s; }
        .log-entry:last-child { border-bottom: none; }
        .log-entry.event { color: var(--warning-color); border-left: 2px solid var(--warning-color); padding-left: 10px; }
        .log-entry.system { color: var(--muted-color); font-size: 0.85rem; text-align: center; border-bottom: none; margin-top: 10px; }

        .action-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            height: auto;
            flex-shrink: 0;
        }

        button {
            background-color: #333;
            border: 1px solid #555;
            color: white;
            padding: 12px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }
        button:active { transform: scale(0.98); background-color: #444; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        button strong { display: block; margin-bottom: 4px; }
        button .cost { font-size: 0.75rem; color: var(--muted-color); opacity: 0.8; }

        /* --- å³å´ï¼šç‹€æ…‹å€ (ä¿®æ­£é‡é») --- */
        .status-panel {
            background-color: var(--panel-color);
            padding: 15px;
            border-radius: 8px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .status-header {
            font-weight: bold;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #ccc;
        }

        .status-effect {
            background-color: #222;
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 3px solid;
            font-size: 0.9rem;
            cursor: pointer; /* æç¤ºå¯é»æ“Š */
            position: relative;
            display: flex;
            flex-wrap: wrap; /* å…è¨±æŠ˜è¡Œ */
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .status-effect:active { background-color: #333; }
        .status-effect.debuff { border-color: var(--danger-color); }
        .status-effect.buff { border-color: var(--accent-color); }

        .status-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .stack-count {
            background-color: #555;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        .info-icon {
            font-size: 0.8rem;
            margin-left: 5px;
            opacity: 0.5;
        }

        /* Tooltip ä¿®æ”¹ç‚ºåµŒå…¥å¼å±•é–‹å€å¡Š */
        .tooltip-box {
            display: none; /* é è¨­éš±è— */
            width: 100%;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #444;
            color: #ddd;
            font-size: 0.85rem;
            line-height: 1.4;
            animation: expandOpen 0.3s ease-out;
        }

        .tooltip-box strong { color: var(--accent-color); display: block; margin-bottom: 3px; }
        .tooltip-box em { display: block; margin-top: 5px; color: #888; font-size: 0.8rem; }

        /* ç•¶ç‹€æ…‹è¢«åŠ ä¸Š .expanded class æ™‚ï¼Œé¡¯ç¤º tooltip */
        .status-effect.expanded { background-color: #2a2a2a; }
        .status-effect.expanded .tooltip-box { display: block; }
        .status-effect.expanded .info-icon { transform: rotate(180deg); }

        @keyframes expandOpen {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- RWD: æ‰‹æ©Ÿç›´å¼ç‰ˆé¢ --- */
        @media (max-width: 768px) {
            body { align-items: flex-start; height: 100dvh; }
            .game-container {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100dvh;
                max-width: none;
                padding: 10px;
                border-radius: 0;
                gap: 10px;
            }

            /* ä¸Šæ–¹ï¼šæ•¸å€¼å€ */
            .stats-panel {
                flex-direction: row;
                flex-wrap: wrap;
                padding: 10px;
                gap: 10px;
                flex-shrink: 0;
                min-height: auto;
                justify-content: space-between;
                align-items: center;
            }
            .avatar { display: none; }
            .header-info { width: 100%; text-align: left; padding-bottom: 5px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; margin: 0; }
            .stat-group { width: 48%; margin-bottom: 0; }
            .stat-group:last-child { width: 100%; margin-top: 5px; display: flex; justify-content: space-between; background: #222; padding: 5px 10px; border-radius: 4px; }
            .stat-group:last-child .stat-label { margin: 0; width: 100%; }

            /* ä¸­é–“ï¼šéŠæˆ²å€ */
            .main-panel { flex-grow: 1; min-height: 0; }
            .action-area { height: auto; grid-template-columns: 1fr 1fr; }
            button { padding: 15px 5px; }

            /* ä¸‹æ–¹ï¼šç‹€æ…‹å€ */
            .status-panel {
                max-height: 35%; /* çµ¦ç‹€æ…‹å€å¤šä¸€é»ç©ºé–“ä»¥ä¾¿å±•é–‹ */
                flex-shrink: 0;
                padding: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div class="stats-panel">
            <div class="avatar" id="avatar-display">ğŸ˜</div>
            <div class="header-info">
                <span>ğŸ“… ç¬¬ <span id="month-display">1</span> æœˆ</span>
                <span id="mobile-mood" style="font-size:1.2rem; display:none;">ğŸ˜</span>
            </div>
            
            <div class="stat-group">
                <div class="stat-label">
                    <span>âš¡ ç†æ™º</span>
                    <span id="sanity-val">60</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sanity-bar" style="width: 60%; background-color: #e23e57;"></div>
                </div>
            </div>

            <div class="stat-group">
                <div class="stat-label">
                    <span>ğŸ¤ é€£çµ</span>
                    <span id="social-val">40</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="social-bar" style="width: 40%; background-color: #4ecca3;"></div>
                </div>
            </div>

            <div class="stat-group">
                <div class="stat-label">
                    <span>ğŸ’° å­˜æ¬¾: <span id="money-val" style="color:#fce38a">$2000</span></span>
                </div>
            </div>
        </div>

        <div class="main-panel">
            <div class="log-area" id="game-log">
                <div class="log-entry system">ç³»çµ±ï¼šæ¨¡æ“¬é–‹å§‹ã€‚ç›®æ¨™æ˜¯å­˜æ´» 12 å€‹æœˆã€‚</div>
                <div class="log-entry">ä½ å‰›å›åˆ°ç§Ÿå±‹è™•ã€‚æˆ¿é–“å¾ˆäº‚ï¼Œæ‰‹æ©Ÿæœ‰å¹¾é€šæœªæ¥ä¾†é›»ï¼Œä¸çŸ¥é“æ˜¯å‚µä¸»é‚„æ˜¯å®¶äººã€‚</div>
            </div>
            
            <div class="action-area">
                <button onclick="takeAction('work')">
                    <strong>ğŸ‘· æ‰“é›¶å·¥</strong>
                    <span class="cost">+$$ | -ç†æ™º | è§¸ç™¼äº‹ä»¶</span>
                </button>
                <button onclick="takeAction('connect')">
                    <strong>ğŸ“ è¯ç¹«è¦ªå‹</strong>
                    <span class="cost">+é€£çµ | éš¨æ©Ÿåæ‡‰</span>
                </button>
                <button onclick="takeAction('therapy')">
                    <strong>ğŸ’Š å¿ƒç†è«®å•†</strong>
                    <span class="cost">-$1000 | ++ç†æ™º</span>
                </button>
                <button onclick="takeAction('rest')">
                    <strong>ğŸ›Œ ä¼‘æ¯ç¨è™•</strong>
                    <span class="cost">+ç†æ™º | ç„¡æ”¶å…¥</span>
                </button>
            </div>
        </div>

        <div class="status-panel">
            <div class="status-header">ç•¶å‰ç‹€æ…‹ (é»æ“ŠæŸ¥çœ‹è©³æƒ…)</div>
            <div id="status-container">
                </div>
        </div>
    </div>

    <script>
        // --- éŠæˆ²æ•¸æ“šçµæ§‹ ---
        const gameState = {
            month: 1,
            maxMonths: 12,
            sanity: 60,
            social: 30,
            money: 5000,
            costOfLiving: 3000,
            gameOver: false,
            activeEffects: [] 
        };

        const effectDB = {
            'stigma': {
                name: 'ç¤¾æœƒæ¨™ç±¤', type: 'debuff',
                desc: 'ä»–äººç•°æ¨£çš„çœ¼å…‰ï¼Œé™ä½ç¤¾äº¤æˆåŠŸç‡ã€‚',
                onTurn: (lvl) => ({ sanity: -1 * lvl })
            },
            'withdrawal': {
                name: 'æˆ’æ–·åæ‡‰', type: 'debuff',
                desc: 'èº«é«”è¨˜æ†¶åœ¨å‘¼å–šæ¯’å“ã€‚æ¥µåº¦å±éšªã€‚',
                onTurn: (lvl) => ({ sanity: -5 * lvl })
            },
            'suspicion': {
                name: 'è·å ´ç–‘æ…®', type: 'debuff',
                desc: 'è€é—†æ­£åœ¨ç›¯è‘—ä½ ã€‚å·¥ä½œå¤±æ•—ç‡æå‡ã€‚',
                onTurn: (lvl) => ({ social: -2 * lvl })
            },
            'trust': {
                name: 'ä¿¡ä»»ç©ç´¯', type: 'buff',
                desc: 'é‡å»ºä¿¡ç”¨ä¸­ã€‚ç¤¾äº¤æ•ˆæœæå‡ã€‚',
                onTurn: (lvl) => ({ social: 1 * lvl, sanity: 1 })
            },
            'anxiety': {
                name: 'ç„¦æ…®', type: 'debuff',
                desc: 'é æœŸæ€§ç„¦æ…®ï¼Œå®³æ€•è¢«æ­ç©¿ã€‚',
                onTurn: (lvl) => ({ sanity: -3 * lvl })
            },
            'motivated': {
                name: 'ç”Ÿæ´»å‹•åŠ›', type: 'buff',
                desc: 'é€™å¹¾å¤©æ„Ÿè¦ºä¸éŒ¯ï¼Œå·¥ä½œæ•ˆç‡æå‡ã€‚',
                onTurn: (lvl) => ({ money: 500 * lvl })
            }
        };

        function updateUI() {
            document.getElementById('month-display').innerText = gameState.month;
            document.getElementById('sanity-val').innerText = Math.floor(gameState.sanity);
            document.getElementById('sanity-bar').style.width = `${Math.max(0, Math.min(100, gameState.sanity))}%`;
            document.getElementById('social-val').innerText = Math.floor(gameState.social);
            document.getElementById('social-bar').style.width = `${Math.max(0, Math.min(100, gameState.social))}%`;
            document.getElementById('money-val').innerText = `$${gameState.money}`;

            const moodIcon = gameState.sanity > 70 ? 'ğŸ™‚' : (gameState.sanity > 40 ? 'ğŸ˜' : (gameState.sanity > 20 ? 'ğŸ˜°' : 'ğŸ§Ÿ'));
            document.getElementById('avatar-display').innerText = moodIcon;
            
            const mobileMood = document.getElementById('mobile-mood');
            if(window.innerWidth <= 768) {
                mobileMood.style.display = 'inline';
                mobileMood.innerText = moodIcon;
            }

            const container = document.getElementById('status-container');
            container.innerHTML = '';
            
            if (gameState.activeEffects.length === 0) {
                container.innerHTML = '<div style="color:#555; font-style:italic; font-size:0.8rem;">ç„¡ç‰¹æ®Šç‹€æ…‹</div>';
            }

            gameState.activeEffects.forEach(effect => {
                const dbEntry = effectDB[effect.id];
                const div = document.createElement('div');
                div.className = `status-effect ${dbEntry.type}`;
                // é»æ“Šäº‹ä»¶ï¼šåˆ‡æ› class 'expanded'
                div.onclick = function() {
                    // æ”¶èµ·å…¶ä»–å·²å±•é–‹çš„
                    document.querySelectorAll('.status-effect.expanded').forEach(el => {
                        if(el !== this) el.classList.remove('expanded');
                    });
                    this.classList.toggle('expanded');
                };
                
                let stackHtml = effect.level > 1 ? `<span class="stack-count">${effect.level}</span>` : '';
                
                div.innerHTML = `
                    <div class="status-info-row">
                        <span>${dbEntry.name} <small>(${effect.duration}æœˆ)</small>${stackHtml}</span>
                        <span class="info-icon">â„¹ï¸</span>
                    </div>
                    <div class="tooltip-box">
                        <strong>${dbEntry.name} (Lv ${effect.level})</strong>
                        ${dbEntry.desc}<br>
                        <em>æŒçºŒå‰©é¤˜: ${effect.duration} å›åˆ</em>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function log(msg, type = 'normal') {
            const logArea = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = msg;
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function addEffect(id, duration, levelAdd = 1) {
            const existing = gameState.activeEffects.find(e => e.id === id);
            if (existing) {
                existing.level += levelAdd;
                existing.duration = Math.max(existing.duration, duration);
                log(`ç‹€æ…‹è®Šæ›´ï¼š<strong>${effectDB[id].name}</strong> Lv ${existing.level}`, 'system');
            } else {
                gameState.activeEffects.push({ id: id, level: levelAdd, duration: duration });
                log(`ç²å¾—ç‹€æ…‹ï¼š<strong>${effectDB[id].name}</strong>`, 'system');
            }
        }

        function removeEffect(id) {
            gameState.activeEffects = gameState.activeEffects.filter(e => e.id !== id);
        }

        function calculateTurnEffects() {
            gameState.activeEffects.forEach(effect => {
                const dbEntry = effectDB[effect.id];
                if (dbEntry.onTurn) {
                    const changes = dbEntry.onTurn(effect.level);
                    if (changes.sanity) gameState.sanity += changes.sanity;
                    if (changes.social) gameState.social += changes.social;
                    if (changes.money) gameState.money += changes.money;
                }
                effect.duration--;
            });
            const expired = gameState.activeEffects.filter(e => e.duration <= 0);
            if (expired.length > 0) {
                expired.forEach(e => log(`ç‹€æ…‹æ¶ˆé€€ï¼š${effectDB[e.id].name}`, 'system'));
                gameState.activeEffects = gameState.activeEffects.filter(e => e.duration > 0);
            }
        }

        function checkEndGame() {
            if (gameState.sanity <= 0) {
                log("çµå±€ï¼šç†æ™ºæ–·ç·šã€‚ä½ åœ¨çµ•æœ›ä¸­å¾©ç™¼äº†ã€‚(Bad End)", "event");
                disableButtons();
                return true;
            }
            if (gameState.money < -5000) {
                log("çµå±€ï¼šå› å‚µå‹™è¢«è¿«çŠ¯ç½ªè¢«æ•ã€‚(Bad End)", "event");
                disableButtons();
                return true;
            }
            if (gameState.month > gameState.maxMonths) {
                log("çµå±€ï¼šä½ æ’éäº†ç¬¬ä¸€å¹´ã€‚é€™å°±æ˜¯å¹³å‡¡è€Œå‰å¤§çš„å‹åˆ©ã€‚(Good End)", "event");
                disableButtons();
                return true;
            }
            return false;
        }

        function disableButtons() {
            document.querySelectorAll('button').forEach(b => b.disabled = true);
            gameState.gameOver = true;
        }

        function takeAction(actionType) {
            if (gameState.gameOver) return;

            let actionLog = "";
            let risk = Math.random();
            const stigmaLevel = gameState.activeEffects.find(e => e.id === 'stigma')?.level || 0;
            const suspicionLevel = gameState.activeEffects.find(e => e.id === 'suspicion')?.level || 0;

            if (actionType === 'work') {
                let income = 4000;
                let sanityCost = 10;
                if (suspicionLevel > 0) { income -= 500 * suspicionLevel; sanityCost += 5 * suspicionLevel; }
                if (risk < 0.2 + (stigmaLevel * 0.1)) {
                    gameState.sanity -= 15;
                    addEffect('anxiety', 2, 1);
                    addEffect('suspicion', 3, 1);
                    actionLog += "åŒäº‹åœ¨èƒŒå¾Œè­°è«–ä½ çš„éå»ï¼Œä½ æ„Ÿåˆ°æ¥µåº¦ç„¦æ…®ã€‚";
                } else {
                    gameState.money += income;
                    gameState.sanity -= sanityCost;
                    actionLog += `åŠªåŠ›å·¥ä½œäº†ä¸€å€‹æœˆã€‚æ”¶å…¥ +$${income}ã€‚`;
                    if (Math.random() > 0.7) addEffect('motivated', 2);
                }
            } 
            else if (actionType === 'connect') {
                if (risk < 0.3 + (stigmaLevel * 0.1)) {
                    gameState.sanity -= 10;
                    gameState.social -= 5;
                    addEffect('stigma', 3, 1);
                    actionLog += "å®¶äººå†æ¬¡æèµ·ä½ çš„ã€å‰ç§‘ã€ï¼Œä¸æ­¡è€Œæ•£ã€‚";
                } else {
                    gameState.social += 15;
                    gameState.sanity += 5;
                    addEffect('trust', 2, 1);
                    actionLog += "æœ‹å‹é¡˜æ„è½ä½ èªªè©±ï¼Œæ„Ÿè¦ºæ²’é‚£éº¼å­¤å–®äº†ã€‚";
                }
            }
            else if (actionType === 'therapy') {
                if (gameState.money < 1000) { log("å­˜æ¬¾ä¸è¶³ã€‚", "event"); return; }
                gameState.money -= 1000;
                gameState.sanity += 25;
                const anxiety = gameState.activeEffects.find(e => e.id === 'anxiety');
                if (anxiety) {
                    anxiety.level = Math.max(0, anxiety.level - 2);
                    if (anxiety.level === 0) removeEffect('anxiety');
                    actionLog += "è«®å•†æ¸›è¼•äº†ç„¦æ…®ã€‚";
                } else {
                    actionLog += "è«®å•†è®“ä½ é‡æ¸…äº†æ··äº‚çš„æ€ç·’ã€‚";
                }
            }
            else if (actionType === 'rest') {
                gameState.sanity += 10;
                actionLog += "æŠŠè‡ªå·±é—œåœ¨æˆ¿é–“ç¡äº†ä¸€æ•´å¤©ã€‚";
                if (Math.random() > 0.8) addEffect('stigma', 2, 1);
            }

            gameState.money -= gameState.costOfLiving;
            log(actionLog);
            
            calculateTurnEffects();
            triggerRandomEvent();

            gameState.month++;
            if (!checkEndGame()) updateUI();
            else updateUI();
        }

        function triggerRandomEvent() {
            if (Math.random() > 0.7) {
                const events = [
                    { t: "ã€èª˜æƒ‘ã€‘è—¥é ­å‚³ç°¡è¨Šä¾†ï¼šã€Œæœ€è¿‘æœ‰å¥½è²¨ã€‚ã€", e: () => addEffect('withdrawal', 2, 1) },
                    { t: "ã€æ–°èã€‘ç¶²ç´…å¸æ¯’è¢«æ•ï¼Œè¼¿è«–è¬¾ç½µã€‚", e: () => { addEffect('anxiety', 3, 1); addEffect('stigma', 3, 1); } },
                    { t: "ã€æ©Ÿæœƒã€‘é„°å±…é€äº†æ°´æœï¼Œæ²’æœ‰å•éå»ã€‚", e: () => { gameState.sanity += 10; gameState.social += 5; } }
                ];
                const evt = events[Math.floor(Math.random() * events.length)];
                log(evt.t, "event");
                evt.e();
            }
        }

        addEffect('stigma', 12, 1);
        updateUI();

    </script>
</body>
</html>