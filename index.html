<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®å…‰è¨ˆç•«ï¼šå¾©æ­¸æ—…ç¨‹ (Project Glimmer)</title>
    <style>
        :root {
            --bg-color: #1a1a1d;
            --panel-color: #2b2b2e;
            --text-color: #e0e0e0;
            --accent-color: #4ecca3;
            --danger-color: #e23e57;
            --warning-color: #fce38a;
            --muted-color: #95a5a6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            width: 95%;
            max-width: 1200px;
            height: 85vh;
            background-color: #000;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* å·¦å´ï¼šæ•¸å€¼å€ */
        .stats-panel {
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .avatar {
            width: 100px;
            height: 100px;
            background-color: #444;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 2px solid var(--muted-color);
        }

        .stat-group {
            margin-bottom: 10px;
            position: relative;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 5px;
            cursor: help;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        /* ä¸­é–“ï¼šè¡Œå‹•èˆ‡åŠ‡æƒ… */
        .main-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .log-area {
            flex-grow: 1;
            background-color: var(--panel-color);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            border-left: 4px solid var(--accent-color);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
            animation: fadeIn 0.5s;
        }
        
        .log-entry.event { color: var(--warning-color); }
        .log-entry.system { color: var(--muted-color); font-size: 0.85rem; }

        .action-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            height: 150px;
        }

        button {
            background-color: #333;
            border: 1px solid #555;
            color: white;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            position: relative;
        }

        button:hover:not(:disabled) {
            background-color: #444;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button .cost {
            display: block;
            font-size: 0.8rem;
            color: var(--muted-color);
            margin-top: 5px;
        }

        /* å³å´ï¼šç‹€æ…‹æ•ˆæœ (Buffs/Debuffs) */
        .status-panel {
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 8px;
            overflow-y: auto;
        }

        .status-header {
            font-weight: bold;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .status-effect {
            background-color: #222;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 3px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .status-effect.debuff { border-color: var(--danger-color); }
        .status-effect.buff { border-color: var(--accent-color); }
        
        .stack-count {
            background-color: #555;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Tooltip */
        .tooltip {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0,0,0,0.9);
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 100%; 
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            border: 1px solid #555;
            pointer-events: none;
        }

        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header Info */
        .header-info {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent-color);
            font-size: 1.2rem;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div class="stats-panel">
            <div class="avatar" id="avatar-display">ğŸ˜</div>
            <div class="header-info">
                ç¬¬ <span id="month-display">1</span> æœˆ
            </div>
            
            <div class="stat-group has-tooltip">
                <div class="stat-label">
                    <span>ç†æ™º (Willpower)</span>
                    <span id="sanity-val">60/100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sanity-bar" style="width: 60%; background-color: #e23e57;"></div>
                </div>
                <div class="tooltip">ä»£è¡¨å¤§è…¦çš„å‰é¡è‘‰åŠŸèƒ½èˆ‡æŠ—å£“æ€§ã€‚éä½æœƒå°è‡´è‡ªå‹•è§¸ç™¼ã€Œå¾©ç™¼äº‹ä»¶ã€æˆ–ç„¡æ³•æ§åˆ¶é¸é …ã€‚</div>
            </div>

            <div class="stat-group has-tooltip">
                <div class="stat-label">
                    <span>ç¤¾æœƒé€£çµ (Social)</span>
                    <span id="social-val">40/100</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="social-bar" style="width: 40%; background-color: #4ecca3;"></div>
                </div>
                <div class="tooltip">ä»£è¡¨ä¿¡ä»»å­˜æ‘ºã€‚æ•¸å€¼è¶Šé«˜ï¼Œè¶Šå®¹æ˜“ç²å¾—æ±‚è·æ©Ÿæœƒæˆ–å€Ÿè²¸å”åŠ©ã€‚éä½æœƒé™·å…¥å­¤ç«‹ã€‚</div>
            </div>

            <div class="stat-group has-tooltip">
                <div class="stat-label">
                    <span>å­˜æ¬¾ (Money)</span>
                    <span id="money-val">$2000</span>
                </div>
                <div class="tooltip">ç”Ÿå­˜åº•ç·šã€‚æ¯æœˆéœ€æ‰£é™¤ $3000 ç”Ÿæ´»é–‹éŠ·ã€‚æ­¸é›¶å°‡è¿«ä½¿ä½ é‹Œè€Œèµ°éšªã€‚</div>
            </div>
        </div>

        <div class="main-panel">
            <div class="log-area" id="game-log">
                <div class="log-entry system">ç³»çµ±ï¼šéŠæˆ²é–‹å§‹ã€‚ç›®æ¨™æ˜¯å­˜æ´» 12 å€‹æœˆä¸¦å›æ­¸ç¤¾æœƒã€‚</div>
                <div class="log-entry">ä½ å‰›çµæŸå‹’æˆ’å›åˆ°ç§Ÿå±‹è™•ã€‚ç©ºæ°£ä¸­æœ‰ä¸€è‚¡éœ‰å‘³ï¼Œæ‰‹æ©Ÿè£¡æœ‰å¹¾é€šæœªæ¥ä¾†é›»ï¼Œä¸çŸ¥é“æ˜¯å‚µä¸»é‚„æ˜¯å®¶äººã€‚</div>
            </div>
            
            <div class="action-area">
                <button onclick="takeAction('work')">
                    <strong>æ‰“é›¶å·¥</strong>
                    <span class="cost">+$$$ | -ç†æ™º | å¯èƒ½è§¸ç™¼æ­§è¦–</span>
                </button>
                <button onclick="takeAction('connect')">
                    <strong>è¯ç¹«è¦ªå‹</strong>
                    <span class="cost">+é€£çµ | -ç†æ™º(å¯èƒ½) | ä¿®å¾©é—œä¿‚</span>
                </button>
                <button onclick="takeAction('therapy')">
                    <strong>å¿ƒç†è«®å•†</strong>
                    <span class="cost">-$1000 | ++ç†æ™º | æ¶ˆé™¤è² é¢ç‹€æ…‹</span>
                </button>
                <button onclick="takeAction('rest')">
                    <strong>ä¼‘æ¯ç¨è™•</strong>
                    <span class="cost">+ç†æ™º | ç„¡æ”¶å…¥ | é¿ä¸–</span>
                </button>
            </div>
        </div>

        <div class="status-panel">
            <div class="status-header">ç•¶å‰ç‹€æ…‹ (Status Effects)</div>
            <div id="status-container">
                </div>
            <div style="margin-top: 20px; font-size: 0.8rem; color: #777;">
                <p>ğŸ’¡ æç¤ºï¼šç‹€æ…‹æ•ˆæœæœƒéš¨æ™‚é–“æ¨ç§»æˆ–è¡Œå‹•æ±ºç­–è€Œç–ŠåŠ /æ¶ˆé€€ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // --- éŠæˆ²æ•¸æ“šçµæ§‹ ---
        const gameState = {
            month: 1,
            maxMonths: 12,
            sanity: 60,
            social: 30,
            money: 5000,
            costOfLiving: 3000,
            gameOver: false,
            // é€™è£¡å­˜æ”¾ç•¶å‰æŒæœ‰çš„ç‹€æ…‹ç‰©ä»¶
            // çµæ§‹: { id: 'anxiety', level: 1, duration: 3 }
            activeEffects: [] 
        };

        // --- ç‹€æ…‹æ•ˆæœå®šç¾©åº« (Effect Database) ---
        // é€™äº›æ•ˆæœé¡ä¼¼ Minecraft çš„è—¥æ°´æ•ˆæœ
        const effectDB = {
            'stigma': {
                name: 'ç¤¾æœƒæ¨™ç±¤',
                type: 'debuff',
                desc: 'ä»–äººç•°æ¨£çš„çœ¼å…‰ï¼Œé™ä½ç¤¾äº¤æˆåŠŸç‡ã€‚',
                onTurn: (level) => { return { sanity: -1 * level }; } // æ¯å›åˆæ‰£ç†æ™º
            },
            'withdrawal': {
                name: 'æˆ’æ–·åæ‡‰',
                type: 'debuff',
                desc: 'èº«é«”è¨˜æ†¶åœ¨å‘¼å–šæ¯’å“ã€‚æ¥µåº¦å±éšªã€‚',
                onTurn: (level) => { return { sanity: -5 * level }; }
            },
            'suspicion': {
                name: 'è·å ´ç–‘æ…®',
                type: 'debuff',
                desc: 'è€é—†æ­£åœ¨ç›¯è‘—ä½ ã€‚å·¥ä½œå¤±æ•—ç‡æå‡ã€‚',
                onTurn: (level) => { return { social: -2 * level }; }
            },
            'trust': {
                name: 'ä¿¡ä»»ç©ç´¯',
                type: 'buff',
                desc: 'ä½ æ­£åœ¨é‡å»ºä¿¡ç”¨ã€‚ç¤¾äº¤æ•ˆæœæå‡ã€‚',
                onTurn: (level) => { return { social: 1 * level, sanity: 1 }; }
            },
            'anxiety': {
                name: 'ç„¦æ…®',
                type: 'debuff',
                desc: 'é æœŸæ€§ç„¦æ…®ï¼Œå®³æ€•è¢«æ­ç©¿ã€‚',
                onTurn: (level) => { return { sanity: -3 * level }; }
            },
            'motivated': {
                name: 'ç”Ÿæ´»å‹•åŠ›',
                type: 'buff',
                desc: 'é€™å¹¾å¤©æ„Ÿè¦ºä¸éŒ¯ï¼Œå·¥ä½œæ•ˆç‡æå‡ã€‚',
                onTurn: (level) => { return { money: 500 * level }; } // æ¯å›åˆé¡å¤–æ”¶å…¥
            }
        };

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        function updateUI() {
            // æ›´æ–°æ•¸å€¼
            document.getElementById('month-display').innerText = gameState.month;
            document.getElementById('sanity-val').innerText = `${Math.floor(gameState.sanity)}/100`;
            document.getElementById('sanity-bar').style.width = `${Math.max(0, Math.min(100, gameState.sanity))}%`;
            document.getElementById('social-val').innerText = `${Math.floor(gameState.social)}/100`;
            document.getElementById('social-bar').style.width = `${Math.max(0, Math.min(100, gameState.social))}%`;
            document.getElementById('money-val').innerText = `$${gameState.money}`;

            // æ›´æ–°é ­åƒè¡¨æƒ…
            const avatar = document.getElementById('avatar-display');
            if (gameState.sanity > 70) avatar.innerText = 'ğŸ™‚';
            else if (gameState.sanity > 40) avatar.innerText = 'ğŸ˜';
            else if (gameState.sanity > 20) avatar.innerText = 'ğŸ˜°';
            else avatar.innerText = 'ğŸ§Ÿ';

            // æ¸²æŸ“ç‹€æ…‹åˆ—è¡¨
            const container = document.getElementById('status-container');
            container.innerHTML = '';
            
            if (gameState.activeEffects.length === 0) {
                container.innerHTML = '<div style="color:#555; font-style:italic;">ç›®å‰ç„¡ç‰¹æ®Šç‹€æ…‹</div>';
            }

            gameState.activeEffects.forEach(effect => {
                const dbEntry = effectDB[effect.id];
                const div = document.createElement('div');
                div.className = `status-effect ${dbEntry.type} has-tooltip`;
                
                // è¨ˆç®—ç–ŠåŠ å±¤æ•¸çš„é¡¯ç¤º
                let stackHtml = effect.level > 1 ? `<span class="stack-count">${effect.level}</span>` : '';
                
                div.innerHTML = `
                    <span>${dbEntry.name} <small>(${effect.duration}æœˆ)</small></span>
                    ${stackHtml}
                    <div class="tooltip">
                        <strong>${dbEntry.name} (Lv ${effect.level})</strong><br>
                        ${dbEntry.desc}<br>
                        <em>æŒçºŒå‰©é¤˜: ${effect.duration} å›åˆ</em>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function log(msg, type = 'normal') {
            const logArea = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = msg;
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // æ–°å¢æˆ–ç–ŠåŠ ç‹€æ…‹
        function addEffect(id, duration, levelAdd = 1) {
            const existing = gameState.activeEffects.find(e => e.id === id);
            if (existing) {
                existing.level += levelAdd;
                existing.duration = Math.max(existing.duration, duration); // é‡ç½®æŒçºŒæ™‚é–“æˆ–å–è¼ƒé•·è€…
                log(`ç‹€æ…‹è®Šæ›´ï¼š<strong>${effectDB[id].name}</strong> ç–ŠåŠ åˆ°äº† Lv ${existing.level}`, 'system');
            } else {
                gameState.activeEffects.push({ id: id, level: levelAdd, duration: duration });
                log(`ç²å¾—ç‹€æ…‹ï¼š<strong>${effectDB[id].name}</strong>`, 'system');
            }
        }

        function removeEffect(id) {
            gameState.activeEffects = gameState.activeEffects.filter(e => e.id !== id);
        }

        function calculateTurnEffects() {
            // çµç®—æ‰€æœ‰ç‹€æ…‹å¸¶ä¾†çš„è¢«å‹•å½±éŸ¿
            let report = [];
            gameState.activeEffects.forEach(effect => {
                const dbEntry = effectDB[effect.id];
                if (dbEntry.onTurn) {
                    const changes = dbEntry.onTurn(effect.level);
                    if (changes.sanity) {
                        gameState.sanity += changes.sanity;
                        // report.push(`${dbEntry.name} å½±éŸ¿ç†æ™º ${changes.sanity}`);
                    }
                    if (changes.social) {
                        gameState.social += changes.social;
                    }
                    if (changes.money) {
                        gameState.money += changes.money;
                    }
                }
                effect.duration--;
            });

            // æ¸…é™¤éæœŸç‹€æ…‹
            const expired = gameState.activeEffects.filter(e => e.duration <= 0);
            if (expired.length > 0) {
                expired.forEach(e => log(`ç‹€æ…‹çµæŸï¼š${effectDB[e.id].name} å·²æ¶ˆé€€`, 'system'));
                gameState.activeEffects = gameState.activeEffects.filter(e => e.duration > 0);
            }
        }

        function checkEndGame() {
            if (gameState.sanity <= 0) {
                log("çµå±€ï¼šä½ çš„ç†æ™ºæ–·ç·šäº†ã€‚åœ¨é¾å¤§çš„å£“åŠ›èˆ‡å¹»è¦ºä¸­ï¼Œä½ æ’¥é€šäº†é‚£æ”¯ä¸è©²æ’¥çš„é›»è©±... (Bad End: Relapse)", "event");
                disableButtons();
                return true;
            }
            if (gameState.money < -5000) { // å…è¨±å°é¡è² å‚µ
                log("çµå±€ï¼šæˆ¿æ±æŠŠä½ è¶•äº†å‡ºå»ï¼Œè¨å‚µé›†åœ˜æ‰¾ä¸Šé–€ã€‚ç‚ºäº†ç”Ÿå­˜ï¼Œä½ è¢«è¿«ç•¶äº†è»Šæ‰‹è¢«æ•ã€‚ (Bad End: Crime)", "event");
                disableButtons();
                return true;
            }
            if (gameState.month > gameState.maxMonths) {
                log("çµå±€ï¼šæ­å–œï¼ä½ æ’éäº†ç¬¬ä¸€å¹´ã€‚é›–ç„¶æ¨™ç±¤é‚„åœ¨ï¼Œä½†ä½ å­¸æœƒäº†èˆ‡ä¹‹å…±å­˜ã€‚é€™å°±æ˜¯å¹³å‡¡è€Œå‰å¤§çš„å‹åˆ©ã€‚ (Good End)", "event");
                disableButtons();
                return true;
            }
            return false;
        }

        function disableButtons() {
            const btns = document.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);
            gameState.gameOver = true;
        }

        // --- ç©å®¶è¡Œå‹•é‚è¼¯ ---

        function takeAction(actionType) {
            if (gameState.gameOver) return;

            // 1. åŸ·è¡Œè¡Œå‹•
            let actionLog = "";
            let risk = Math.random();

            // æª¢æŸ¥æ˜¯å¦æœ‰è² é¢æ¨™ç±¤å½±éŸ¿æ©Ÿç‡
            const stigmaLevel = gameState.activeEffects.find(e => e.id === 'stigma')?.level || 0;
            const suspicionLevel = gameState.activeEffects.find(e => e.id === 'suspicion')?.level || 0;

            if (actionType === 'work') {
                // åŸºç¤å·¥ä½œé‚è¼¯
                let income = 4000;
                let sanityCost = 10;
                
                // ç‹€æ…‹å½±éŸ¿
                if (suspicionLevel > 0) {
                    income -= 500 * suspicionLevel;
                    sanityCost += 5 * suspicionLevel;
                    actionLog += "è€é—†å°ä½ çš„çœ¼ç¥å……æ»¿æ‡·ç–‘ï¼Œè®“ä½ å·¥ä½œæ™‚æˆ°æˆ°å…¢å…¢ã€‚";
                }

                if (risk < 0.2 + (stigmaLevel * 0.1)) {
                    // è§¸ç™¼äº‹ä»¶ï¼šè·å ´æ­§è¦–
                    gameState.sanity -= 15;
                    addEffect('anxiety', 2, 1);
                    addEffect('suspicion', 3, 1); // å¢åŠ ç–‘æ…®å±¤æ•¸
                    actionLog += "åŒäº‹ç™¼ç¾ä½ çš„éå»ï¼Œé–‹å§‹åœ¨èƒŒå¾Œç«Šç«Šç§èªã€‚ä½ æ„Ÿåˆ°æ¥µåº¦ç„¦æ…®ã€‚";
                } else {
                    gameState.money += income;
                    gameState.sanity -= sanityCost;
                    actionLog += `ä½ åŠªåŠ›å®Œæˆäº†ä¸€å€‹æœˆçš„é›¶å·¥ã€‚æ”¶å…¥ +$${income}ã€‚`;
                    
                    // æ­£å‘å›é¥‹ï¼šé€£çºŒå·¥ä½œå¯èƒ½ç²å¾—å‹•åŠ›
                    if (Math.random() > 0.7) addEffect('motivated', 2);
                }
            } 
            else if (actionType === 'connect') {
                if (risk < 0.3 + (stigmaLevel * 0.1)) {
                    // è§¸ç™¼äº‹ä»¶ï¼šå®¶åº­è¡çª
                    gameState.sanity -= 10;
                    gameState.social -= 5;
                    addEffect('stigma', 3, 1); // å®¶äººå¼·åŒ–äº†æ¨™ç±¤
                    actionLog += "ä½ æƒ³å›å®¶åƒé£¯ï¼Œä½†å®¶äººå†æ¬¡æèµ·ä½ çš„ã€å‰ç§‘ã€ï¼Œä¸æ­¡è€Œæ•£ã€‚";
                } else {
                    gameState.social += 15;
                    gameState.sanity += 5;
                    addEffect('trust', 2, 1); // å»ºç«‹ä¿¡ä»»
                    actionLog += "æœ‹å‹é¡˜æ„è½ä½ èªªè©±ï¼Œä½ æ„Ÿè¦ºæ²’é‚£éº¼å­¤å–®äº†ã€‚";
                }
            }
            else if (actionType === 'therapy') {
                if (gameState.money < 1000) {
                    log("å­˜æ¬¾ä¸è¶³ï¼Œç„¡æ³•æ”¯ä»˜è«®å•†è²»ç”¨ã€‚", "event");
                    return; 
                }
                gameState.money -= 1000;
                gameState.sanity += 25;
                // æ²»ç™‚å¯ä»¥æ¸›å°‘è² é¢å±¤æ•¸
                const anxiety = gameState.activeEffects.find(e => e.id === 'anxiety');
                if (anxiety) {
                    anxiety.level = Math.max(0, anxiety.level - 2);
                    if (anxiety.level === 0) removeEffect('anxiety');
                    actionLog += "è«®å•†å¸«æ•™ä½ å¦‚ä½•æ‡‰å°ææ…Œï¼Œç„¦æ…®æ¸›è¼•äº†ã€‚";
                } else {
                    actionLog += "è«®å•†è®“ä½ é‡æ¸…äº†æ··äº‚çš„æ€ç·’ã€‚";
                }
            }
            else if (actionType === 'rest') {
                gameState.sanity += 10;
                actionLog += "ä½ æŠŠè‡ªå·±é—œåœ¨æˆ¿é–“è£¡ç¡äº†ä¸€æ•´å¤©ã€‚é›–ç„¶é€ƒé¿äº†å£“åŠ›ï¼Œä½†ä¹Ÿæ²’æœ‰æ”¶å…¥ã€‚";
                // ä¼‘æ¯å¤ªä¹…å¯èƒ½å°è‡´ç¤¾æœƒè„«ç¯€
                if (Math.random() > 0.8) addEffect('stigma', 2, 1); // è‡ªæˆ‘å°é–‰å°è‡´è‡ªæˆ‘æ±¡å
            }

            // 2. æ‰£é™¤ç”Ÿå­˜æˆæœ¬
            gameState.money -= gameState.costOfLiving;
            log(actionLog);
            log(`æœˆåº•æ‰£é™¤ç”Ÿæ´»è²» $${gameState.costOfLiving}`, 'system');

            // 3. è¨ˆç®—å›åˆç‹€æ…‹æ•ˆæœ
            calculateTurnEffects();

            // 4. éš¨æ©Ÿäº‹ä»¶ (Random Event)
            triggerRandomEvent();

            // 5. æ¨é€²æ™‚é–“èˆ‡æ›´æ–°
            gameState.month++;
            if (!checkEndGame()) {
                updateUI();
            } else {
                updateUI(); // æœ€å¾Œæ›´æ–°ä¸€æ¬¡é¡¯ç¤ºçµå±€ç‹€æ…‹
            }
        }

        function triggerRandomEvent() {
            const roll = Math.random();
            if (roll > 0.7) { // 30% æ©Ÿç‡ç™¼ç”Ÿéš¨æ©Ÿäº‹ä»¶
                const events = [
                    {
                        text: "ã€èª˜æƒ‘ã€‘ä»¥å‰çš„è—¥é ­å‚³ç°¡è¨Šä¾†ï¼šã€Œæœ€è¿‘æœ‰å¥½è²¨ï¼Œç®—ä½ ä¾¿å®œã€‚ã€",
                        effect: () => {
                            log("éš¨æ©Ÿäº‹ä»¶ï¼šè—¥é ­çš„èª˜æƒ‘ã€‚ä½ çš„æ„å¿—åŠ›æ­£åœ¨å‹•æ–...", "event");
                            addEffect('withdrawal', 2, 1); // èª˜ç™¼æˆ’æ–·/æ¸´æ±‚
                        }
                    },
                    {
                        text: "ã€æ–°èã€‘é›»è¦–å ±å°æŸç¶²ç´…å¸æ¯’è¢«æ•ï¼Œç¶²è·¯ä¸Šä¸€ç‰‡è¬¾ç½µã€‚",
                        effect: () => {
                            log("éš¨æ©Ÿäº‹ä»¶ï¼šç¤¾æœƒè¼¿è«–å‡æº«ã€‚ä½ è¦ºå¾—å¤§å®¶éƒ½åœ¨ç½µä½ ã€‚", "event");
                            addEffect('anxiety', 3, 1);
                            addEffect('stigma', 3, 1); // ç¤¾æœƒæ¨™ç±¤åŠ é‡
                        }
                    },
                    {
                        text: "ã€æ©Ÿæœƒã€‘ä¸€ä½å¥½å¿ƒçš„é„°å±…é€äº†ä½ ä¸€äº›æ°´æœï¼Œæ²’æœ‰å•ä½ çš„éå»ã€‚",
                        effect: () => {
                            log("éš¨æ©Ÿäº‹ä»¶ï¼šå¾®å°çš„å–„æ„ã€‚é€™è®“ä½ æ„Ÿåˆ°æº«æš–ã€‚", "event");
                            gameState.sanity += 10;
                            gameState.social += 5;
                        }
                    }
                ];
                const evt = events[Math.floor(Math.random() * events.length)];
                evt.effect();
            }
        }

        // åˆå§‹åŒ–
        // é–‹å±€è‡ªå¸¶ç‹€æ…‹ï¼šç¤¾æœƒæ¨™ç±¤ Lv1
        addEffect('stigma', 12, 1);
        updateUI();

    </script>
</body>
</html>